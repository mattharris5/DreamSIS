<h3 class="pre-title"><%= @event.name %></h3>
<h1><%=h @audience.to_s %> Attendance</h1>
	
<table class="attendees">
	<thead>
		<tr>
			<th>Attendee</th>
			<%= content_tag(:th, "High School") if @audience.to_s.downcase == "participant" || @audience.to_s.downcase == "student" %>
			<th>Program(s)</th>
			<th>Phone</th>
			<th>Shift</th>
			<%= "<th class='centered'>Trained?</th>" if @event.training_required?(@audience.to_s) %>
			<th class="centered">RSVP'd?
				<%= link_to "E-mail",
				 				"mailto:#{@event.attendees.rsvpd(@audience).collect{|a| a.email rescue nil }.compact.join(",")}",
								class: 'email button',
								id: 'attending_email_link' %>
				</th>
			<th class="centered">Attended?
				<%= link_to "E-mail",
				 				"mailto:#{@event.attendees.attended(@audience).collect{|a| a.email rescue nil }.compact.join(",")}",
								class: 'email button',
								id: 'attended_email_link' %>
				</th>
			<th class="functions">Functions</th>
		</tr>
	</thead>

	<tbody>
		<%= render partial: 'event_attendance', collection: @event.attendees.audience(@audience).select{|a| a.rsvp? || a.attended? || a.admin? }, locals: { audience: @audience } %>

		<%- if @event.attendees.empty? -%>
			<tr class="empty">
				<td colspan=10>No event attendees yet.</td>
			</tr>
		<% end -%>
	</tbody>
</table>

<%= content_for(:sidebar) do %>
	<p><%= link_to "Back to Event", event_path(@event), class: 'back button' %></p>
	<p><%= link_to "Take Attendnace", checkin_event_event_attendances_path(@event, audience: @audience), class: "edit button" %></p>
	
	<%- form_tag({}, method: :get) do -%>
		<p><%= label_tag :audience, "View Attendance For:" %>
			<%= select_tag :audience,
							options_for_select(%w[Participant Student Mentor Volunteer].collect{|a| ["#{a} (#{@event.rsvpd_count(a)})", a]},
							@audience.to_s.classify),
							onchange: "this.form.submit()" %>
			<%= submit_tag "Go" %>
		</p>
	<% end -%>
<% end %>





<table class="events">
	<thead>
		<tr>
			<th>Event</th>
			<th>Date</th>
			<th>Time</th>
			<th class="centered">RSVP</th>
			<th class="centered">Attended</th>
			<th class="functions">Functions</th>
		</tr>
	</thead>

	<tbody>
		<%= render partial: "event_attendances/event_row", collection: @event_attendances %>
		
		<%- if @event_attendances.empty? -%>
			<tr class="empty">
				<td colspan=10>No events to show.</td>
			</tr>
		<% end -%>
	</tbody>
	
</table>

<h3><%= Customer.visits_Label %> Attendance</h3>
<%= javascript_tag "attendancePersonId = '#{@participant.id.to_s}'" %>

<%- for month in [2,1,0].collect{|i| Date.today.beginning_of_month.months_ago(i) } -%>
<div class="mini calendar calendar-container span4 attendance">
	<%= month_calendar attribute: :start_datetime, start_date: month, beginning_of_week: :sunday do |date| %>
		<%= content_tag :div, date.day, "data-date" => raw(date), class: "attendance-day" %>
	<% end %>
</div>
<% end %>
