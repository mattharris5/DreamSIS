<h1><%=h @audience.to_s %> Attendance
	<small class="light">&raquo; <%= @event.name %></small></h1>
	
<table class="attendees">
	<thead>
		<tr>
			<th>Attendee</th>
			<%= "<th>High School</th>" if @audience.to_s.downcase == "participant" || @audience.to_s.downcase == "student" %>
			<th>Program(s)</th>
			<th>Shift</th>
			<%= "<th class='centered'>Trained?</th>" if @event.training_required?(@audience.to_s) %>
			<th class="centered">RSVP'd?
				<%= link_to "E-mail",
				 				"mailto:#{@event.attendees.rsvpd(@audience).collect{|a| a.email rescue nil }.compact.join(",")}",
								:class => 'email button' %>
				</th>
			<th class="centered">Attended?
				<%= link_to "E-mail",
				 				"mailto:#{@event.attendees.attended(@audience).collect{|a| a.email rescue nil }.compact.join(",")}",
								:class => 'email button' %>
				</th>
			<th colspan=3>Functions</th>
		</tr>
	</thead>

	<tbody>
		<%= render :partial => 'event_attendance', :collection => @event.attendees.all(@audience).select{|a| a.rsvp? || a.attended? }, :locals => { :audience => @audience } %>

		<%- if @event.attendees.empty? -%>
			<tr class="empty">
				<td colspan=10>No event attendees yet.</td>
			</tr>
		<% end -%>
	</tbody>
</table>

<div id="sidebar">
	<p><%= link_to "Back to Event", event_path(@event), :class => 'back button' %></p>
	
	<%- form_tag({}, :method => :get) do -%>
		<p><%= label_tag :audience, "View Attendance For:" %>
			<%= select_tag :audience,
							options_for_select(%w[Participant Student Mentor Volunteer].collect{|a| ["#{a} (#{@event.rsvpd_count(a)})", a]}, 
							@audience.to_s.classify),
							:onchange => "this.form.submit()" %>
			<%= submit_tag "Go" %>
		</p>
	<% end -%>
	
</div>